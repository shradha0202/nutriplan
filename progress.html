<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Progress Tracker - NutriPlan</title>

<!-- Chart.js (kept) -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --bg-100: #F8F9FA;
  --muted: #636E72;
  --accent-1: #6C5CE7;
  --accent-2: #A29BFE;
  --accent-3: #4ECDC4;
  --accent-warm: #FF6B6B;
  --glass: rgba(255,255,255,0.66);
  --card-shadow: 0 12px 30px rgba(16,24,40,0.06);
  --radius: 16px;
  --max-width: 1200px;
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{
  font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg,#F8F9FA 0%, #E8F5F3 100%);
  color:#111827;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  line-height:1.45;
  padding-bottom:40px;
}

/* NAV */
nav{
  position:sticky;top:0;z-index:40;padding:14px 22px;
  background: linear-gradient(180deg, rgba(255,255,255,0.85), rgba(255,255,255,0.7));
  backdrop-filter: blur(8px);
  box-shadow: 0 6px 20px rgba(16,24,40,0.03);
}
.nav-inner{max-width:var(--max-width);margin:0 auto;display:flex;align-items:center;justify-content:space-between}
.brand{display:flex;align-items:center;gap:12px;color:inherit;text-decoration:none}
.brand-logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent-warm),#FFB84D);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800}
.brand-title{font-weight:700}
.nav-links{display:flex;gap:16px}
.nav-links a{color:var(--muted);text-decoration:none;font-weight:700}
.nav-links a:hover{color:var(--accent-warm)}

/* HERO */
.hero{
  max-width:var(--max-width);
  margin:22px auto 18px;
  padding:26px;
  border-radius:14px;
  background: linear-gradient(135deg,var(--accent-3),#95E1D3);
  color:#053023;
  box-shadow:0 10px 30px rgba(78,205,196,0.08);
  display:flex;
  align-items:center;
  gap:20px;
}
.hero-left{flex:1}
.hero h1{font-size:1.6rem;margin-bottom:6px}
.hero p{color:rgba(3,15,13,0.85);opacity:0.95}

/* PAGE CONTAINER */
.container{max-width:var(--max-width);margin:24px auto;padding:0 18px}

/* STATS GRID */
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:18px;margin-bottom:20px}
.stat-card{
  background:var(--glass);
  border-radius:12px;
  padding:18px;
  box-shadow:var(--card-shadow);
  display:flex;
  gap:12px;
  align-items:center;
  border:1px solid rgba(255,255,255,0.6);
}
.stat-icon-wrap{width:54px;height:54px;border-radius:10px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.stat-body{flex:1}
.stat-value{font-size:1.45rem;font-weight:800}
.stat-label{color:var(--muted);font-weight:700}

/* color variations */
.stat-card.calories .stat-icon-wrap{background:linear-gradient(135deg,var(--accent-warm),#FFB84D);color:white}
.stat-card.protein  .stat-icon-wrap{background:linear-gradient(135deg,var(--accent-1),var(--accent-2));color:white}
.stat-card.streak   .stat-icon-wrap{background:linear-gradient(135deg,var(--accent-3),#6EE7B7);color:#013226}
.stat-card.meals    .stat-icon-wrap{background:linear-gradient(135deg,#FFD88B,#FFB84D);color:#4A2A0A}

/* PROGRESS SECTION */
.progress-section{background:white;border-radius:14px;padding:20px;box-shadow:var(--card-shadow);margin-bottom:20px}
.section-title{font-size:1.2rem;font-weight:800;margin-bottom:14px}
.progress-item{margin-bottom:14px}
.progress-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.progress-label{font-weight:700;color:#111827}
.progress-value{font-weight:800;color:var(--accent-3)}
.progress-bar-container{background:#F1F5F9;border-radius:12px;height:34px;overflow:hidden}
.progress-bar{height:100%;border-radius:12px;display:flex;align-items:center;justify-content:center;color:white;font-weight:800;font-size:0.9rem}
.progress-bar.calories{background:linear-gradient(90deg,var(--accent-warm),#FFB84D)}
.progress-bar.protein{background:linear-gradient(90deg,var(--accent-1),var(--accent-2))}
.progress-bar.carbs{background:linear-gradient(90deg,var(--accent-3),#95E1D3)}

/* CHART */
.chart-section{background:white;border-radius:14px;padding:18px;box-shadow:var(--card-shadow);margin-bottom:20px}
.chart-container{position:relative;height:320px}

/* LOG */
.log-section{background:white;border-radius:14px;padding:18px;box-shadow:var(--card-shadow);margin-bottom:20px}
.log-form{background:#FBFDFF;padding:14px;border-radius:12px;margin-bottom:14px;border:1px solid rgba(0,0,0,0.03)}
.form-row{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px;margin-bottom:10px}
.form-group label{font-weight:700;color:#0F172A;margin-bottom:6px;display:block}
.form-group input{padding:10px;border-radius:10px;border:1px solid #E6EEF2;font-size:0.95rem}
.submit-btn{width:100%;padding:12px;border-radius:10px;border:0;background:linear-gradient(90deg,var(--accent-3),#95E1D3);color:white;font-weight:800;cursor:pointer}

/* meal log items */
.meal-log{max-height:360px;overflow:auto;display:flex;flex-direction:column;gap:10px}
.log-item{background:linear-gradient(135deg,#FFF5E5,#FFEFEF);padding:12px;border-radius:10px;display:flex;justify-content:space-between;align-items:center}
.log-info{display:flex;flex-direction:column;gap:6px}
.log-name{font-weight:800}
.log-details{color:var(--muted);font-size:0.9rem}
.log-calories{font-weight:800;color:var(--accent-warm)}

/* motivation */
.motivation-box{border-radius:12px;padding:14px;margin-bottom:18px;background:linear-gradient(135deg,var(--accent-1),var(--accent-2));color:white;box-shadow:0 8px 30px rgba(108,92,231,0.06)}

/* footer */
footer{max-width:var(--max-width);margin:18px auto;padding:18px;text-align:center;color:#fff;background:#111827;border-radius:10px}

/* responsive */
@media(max-width:900px){
  .hero{flex-direction:column;align-items:flex-start}
  .form-row{grid-template-columns:1fr}
  .stats-grid{grid-template-columns:1fr 1fr}
}
@media(max-width:520px){
  .stats-grid{grid-template-columns:1fr}
}
</style>
</head>
<body>

<nav>
  <div class="nav-inner">
    <a class="brand" href="index.html" aria-label="NutriPlan home">
      <div class="brand-logo">NP</div>
      <div class="brand-title">NutriPlan</div>
    </a>

    <div class="nav-links" role="navigation">
      <a href="index.html">Home</a>
      <a href="meals.html">Meals</a>
      <a href="progress.html">Progress</a>
      <a href="sins.html">Sins</a>
      <a href="logic.html">C Logic</a>
      <a href="contact.html">Contact</a>
    </div>
  </div>
</nav>

<!-- Hero -->
<section class="hero" role="region" aria-labelledby="hero-title">
  <div class="hero-left">
    <h1 id="hero-title">Progress Dashboard</h1>
    <p>Track calories, protein, streaks and logs — simple, visual, and private to your browser.</p>
  </div>

  <!-- small summary card -->
  <div style="min-width:220px;padding:8px;border-radius:12px;background:rgba(255,255,255,0.72);border:1px solid rgba(0,0,0,0.03);box-shadow:0 8px 20px rgba(16,24,40,0.04)">
    <div style="font-weight:800;font-size:14px;color:#0F172A">Today</div>
    <div id="todaySummary" style="margin-top:8px;color:var(--muted)">0 kcal • 0g protein</div>
  </div>
</section>

<div class="container">
  <!-- Stats -->
  <div class="stats-grid" role="list">
    <div class="stat-card calories" role="listitem" aria-label="Calories today">
      <div class="stat-icon-wrap" aria-hidden="true">
        <!-- Flame SVG (Fluent-ish) -->
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" aria-hidden="true" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 2s4 3 4.5 6.5C16.9 12 12 16 12 16s-4.9-4-4.5-7.5C8 5 12 2 12 2z" fill="white" />
          <path d="M8.5 11.5c0 0 1.6 1.1 3.5 1.1s3.5-1.1 3.5-1.1c-.5 2.5-2.5 4.8-3.5 5.7-1-.9-3-3.2-3.5-5.7z" fill="rgba(255,255,255,0.12)"/>
        </svg>
      </div>
      <div class="stat-body">
        <div class="stat-value" id="totalCalories">0</div>
        <div class="stat-label">Calories Today</div>
      </div>
    </div>

    <div class="stat-card protein" role="listitem" aria-label="Protein intake">
      <div class="stat-icon-wrap" aria-hidden="true">
        <!-- Dumbbell SVG -->
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" aria-hidden="true" xmlns="http://www.w3.org/2000/svg">
          <rect x="1" y="9" width="3" height="6" rx="1" fill="white"/>
          <rect x="20" y="9" width="3" height="6" rx="1" fill="white"/>
          <rect x="6" y="10.5" width="12" height="3" rx="1.5" fill="white"/>
        </svg>
      </div>
      <div class="stat-body">
        <div class="stat-value" id="totalProtein">0 g</div>
        <div class="stat-label">Protein Intake</div>
      </div>
    </div>

    <div class="stat-card streak" role="listitem" aria-label="Streak">
      <div class="stat-icon-wrap" aria-hidden="true">
        <!-- Calendar-check SVG -->
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" aria-hidden="true" xmlns="http://www.w3.org/2000/svg">
          <rect x="3" y="5" width="18" height="16" rx="3" fill="white"/>
          <path d="M8 10.5l2.2 2.2L16 7" stroke="#013226" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="stat-body">
        <div class="stat-value" id="streak">0</div>
        <div class="stat-label">Day Streak</div>
      </div>
    </div>

    <div class="stat-card meals" role="listitem" aria-label="Meals logged">
      <div class="stat-icon-wrap" aria-hidden="true">
        <!-- Plate + cutlery -->
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" aria-hidden="true" xmlns="http://www.w3.org/2000/svg">
          <circle cx="10" cy="12" r="6" fill="white"/>
          <rect x="17" y="7" width="2" height="10" rx="1" fill="white"/>
          <rect x="20" y="9" width="2" height="6" rx="1" fill="white"/>
        </svg>
      </div>
      <div class="stat-body">
        <div class="stat-value" id="mealCount">0</div>
        <div class="stat-label">Meals Logged</div>
      </div>
    </div>
  </div>

  <!-- Motivation -->
  <div class="motivation-box" id="motivationBox" role="region" aria-live="polite">
    <div style="font-weight:800;font-size:1rem">Welcome — keep it consistent</div>
    <div style="opacity:0.92;margin-top:6px">Log meals to track progress. NutriPlan saves data in your browser only.</div>
  </div>

  <!-- Progress bars -->
  <section class="progress-section" aria-labelledby="targets-title">
    <h2 id="targets-title" class="section-title">Today's Targets</h2>

    <div class="progress-item">
      <div class="progress-header">
        <div class="progress-label">Daily Calories</div>
        <div class="progress-value"><span id="currentCal">0</span> / <span id="targetCal">2000</span> kcal</div>
      </div>
      <div class="progress-bar-container" aria-hidden="true">
        <div id="calProgress" class="progress-bar calories" style="width:0%">0%</div>
      </div>
    </div>

    <div class="progress-item">
      <div class="progress-header">
        <div class="progress-label">Protein Goal</div>
        <div class="progress-value"><span id="currentProtein">0</span> / <span id="targetProtein">80</span> g</div>
      </div>
      <div class="progress-bar-container">
        <div id="proteinProgress" class="progress-bar protein" style="width:0%">0%</div>
      </div>
    </div>

    <div class="progress-item">
      <div class="progress-header">
        <div class="progress-label">Carbs</div>
        <div class="progress-value"><span id="currentCarbs">0</span> / <span id="targetCarbs">250</span> g</div>
      </div>
      <div class="progress-bar-container">
        <div id="carbsProgress" class="progress-bar carbs" style="width:0%">0%</div>
      </div>
    </div>
  </section>

  <!-- Weekly chart -->
  <section class="chart-section" aria-labelledby="weekly-title">
    <h2 id="weekly-title" class="section-title">Weekly Calorie Intake</h2>
    <div class="chart-container">
      <canvas id="weeklyChart" aria-label="Weekly calorie chart"></canvas>
    </div>
  </section>

  <!-- Log form + meal list -->
  <section class="log-section" aria-labelledby="log-title">
    <h2 id="log-title" class="section-title">Log Your Meal</h2>

    <form id="logForm" class="log-form" onsubmit="logMeal(event)" novalidate>
      <div class="form-row">
        <div class="form-group">
          <label for="mealName">Meal Name</label>
          <input id="mealName" type="text" placeholder="Paneer Bhurji" required>
        </div>
        <div class="form-group">
          <label for="mealCalories">Calories (kcal)</label>
          <input id="mealCalories" type="number" placeholder="320" min="1" required>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="mealProtein">Protein (g)</label>
          <input id="mealProtein" type="number" placeholder="18" min="0" value="0">
        </div>
        <div class="form-group">
          <label for="mealCarbs">Carbs (g)</label>
          <input id="mealCarbs" type="number" placeholder="35" min="0" value="0">
        </div>
      </div>

      <button type="submit" class="submit-btn">Log Meal</button>
    </form>

    <h3 style="font-weight:800;margin-bottom:10px">Today's Meals</h3>
    <div id="mealLog" class="meal-log" aria-live="polite">
      <div style="text-align:center;color:var(--muted);padding:18px">No meals logged yet. Start by adding your first meal.</div>
    </div>
  </section>

</div>

<footer>
  <div>Contact: <a href="mailto:nutriplan.support@gmail.com" style="color:#9AE6B4">nutriplan.support@gmail.com</a></div>
  <div style="opacity:0.85;margin-top:6px">© 2024 NutriPlan — Built by Shradha</div>
</footer>

<script>
/* ===================== Data storage ===================== */
let mealLog = JSON.parse(localStorage.getItem('nutriplan_meal_log') || '[]');
let weeklyData = JSON.parse(localStorage.getItem('nutriplan_weekly_data') || '{}');

/* Ensure weeklyData has keys Mon..Sun */
const weekKeys = ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'];
if (!weekKeys.every(k => Object.prototype.hasOwnProperty.call(weeklyData,k))) {
  weeklyData = { Mon:0, Tue:0, Wed:0, Thu:0, Fri:0, Sat:0, Sun:0, ...weeklyData };
  localStorage.setItem('nutriplan_weekly_data', JSON.stringify(weeklyData));
}

/* --------- Helpers --------- */
function todayDateString() {
  return new Date().toLocaleDateString();
}

function dayShortName(date = new Date()){
  return date.toLocaleDateString('en-US',{ weekday: 'short' });
}

/* Calculate today's totals */
function calculateTotals() {
  const today = todayDateString();
  const todayMeals = mealLog.filter(m => {
    const ts = m.timestamp || m.ts || (m.date ? new Date(m.date).getTime() : null);
    if (!ts) return false;
    return new Date(ts).toLocaleDateString() === today;
  });

  let totalCal = 0, totalProtein = 0, totalCarbs = 0;
  todayMeals.forEach(m => {
    totalCal += Number(m.calories || 0);
    totalProtein += Number(m.protein || 0);
    totalCarbs += Number(m.carbs || 0);
  });

  return { totalCal, totalProtein, totalCarbs, count: todayMeals.length, todayMeals };
}

/* Update stats and progress bars */
function updateDisplay() {
  const { totalCal, totalProtein, totalCarbs, count } = calculateTotals();

  document.getElementById('totalCalories').textContent = totalCal;
  document.getElementById('totalProtein').textContent = totalProtein + ' g';
  document.getElementById('mealCount').textContent = count;

  const targetCal = Number(document.getElementById('targetCal').textContent) || 2000;
  const targetProtein = Number(document.getElementById('targetProtein').textContent) || 80;
  const targetCarbs = Number(document.getElementById('targetCarbs').textContent) || 250;

  const calPercent = Math.min(Math.round((totalCal / targetCal) * 100), 100);
  const proteinPercent = Math.min(Math.round((totalProtein / targetProtein) * 100), 100);
  const carbsPercent = Math.min(Math.round((totalCarbs / targetCarbs) * 100), 100);

  const calBar = document.getElementById('calProgress');
  const protBar = document.getElementById('proteinProgress');
  const carbsBar = document.getElementById('carbsProgress');

  calBar.style.width = calPercent + '%';
  calBar.textContent = calPercent + '%';

  protBar.style.width = proteinPercent + '%';
  protBar.textContent = proteinPercent + '%';

  carbsBar.style.width = carbsPercent + '%';
  carbsBar.textContent = carbsPercent + '%';

  // small summary
  document.getElementById('todaySummary').textContent = `${totalCal} kcal • ${totalProtein} g protein`;

  updateMotivation(totalCal, targetCal, count);
  displayMealLog();
  calculateStreak();
}

/* Motivation */
function updateMotivation(totalCal, targetCal, count) {
  const box = document.getElementById('motivationBox');
  const percent = totalCal / Math.max(targetCal,1);

  let title = '', body = '';

  if (count === 0) {
    title = 'Start tracking';
    body = 'Log your first meal to begin tracking your progress.';
  } else if (percent < 0.5) {
    title = 'Good progress';
    body = "You're under half your target. Keep it steady.";
  } else if (percent < 0.9) {
    title = 'On track';
    body = "Nice — you're approaching your daily target.";
  } else if (percent <= 1.1) {
    title = 'Goal reached';
    body = "Great job — you've hit your daily calorie target.";
  } else {
    title = 'Over target';
    body = "You've exceeded today's target. Consider lighter meals or a walk.";
  }

  box.innerHTML = `<div style="font-weight:800;font-size:1rem">${title}</div><div style="opacity:0.95;margin-top:6px">${body}</div>`;
}

/* Display today's logged meals */
function displayMealLog() {
  const container = document.getElementById('mealLog');
  const today = todayDateString();

  const todayMeals = mealLog
    .filter(m => {
      const ts = m.timestamp || m.ts || (m.date ? new Date(m.date).getTime() : null);
      if (!ts) return false;
      return new Date(ts).toLocaleDateString() === today;
    })
    .sort((a,b) => (b.timestamp || b.ts || 0) - (a.timestamp || a.ts || 0));

  if (!todayMeals.length) {
    container.innerHTML = `<div style="text-align:center;color:var(--muted);padding:18px">No meals logged yet. Start by adding your first meal.</div>`;
    return;
  }

  container.innerHTML = todayMeals.map(m => {
    const timeStr = new Date(m.timestamp || m.ts || m.date).toLocaleTimeString();
    return `
      <div class="log-item">
        <div class="log-info">
          <div class="log-name">${escapeHtml(m.name)}</div>
          <div class="log-details">Protein: ${m.protein || 0} g • Carbs: ${m.carbs || 0} g • ${timeStr}</div>
        </div>
        <div class="log-calories">${m.calories} kcal</div>
      </div>
    `;
  }).join('');
}

/* Safe text */
function escapeHtml(s){ return String(s).replace(/[&<>"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c])); }

/* Logging a meal */
function logMeal(e) {
  e.preventDefault();

  const name = document.getElementById('mealName').value.trim();
  const calories = Number(document.getElementById('mealCalories').value) || 0;
  const protein = Number(document.getElementById('mealProtein').value) || 0;
  const carbs = Number(document.getElementById('mealCarbs').value) || 0;

  if (!name || calories <= 0) {
    alert('Please provide a meal name and valid calories.');
    return;
  }

  const item = {
    name, calories, protein, carbs,
    date: new Date().toLocaleString(),
    timestamp: Date.now()
  };

  mealLog.push(item);
  localStorage.setItem('nutriplan_meal_log', JSON.stringify(mealLog));

  // update weekly totals
  const day = dayShortName();
  weeklyData[day] = (Number(weeklyData[day]) || 0) + calories;
  localStorage.setItem('nutriplan_weekly_data', JSON.stringify(weeklyData));

  // clear form
  document.getElementById('logForm').reset();

  // refresh UI & chart
  updateDisplay();
  updateChart();

  // small non-blocking notification
  showToast(`${name} logged (${calories} kcal)`);
}

/* Toast */
function showToast(text){
  const n = document.createElement('div');
  n.textContent = text;
  n.style.cssText = 'position:fixed;right:18px;bottom:18px;background:#111827;color:#fff;padding:10px 14px;border-radius:10px;box-shadow:0 12px 30px rgba(16,24,40,0.2);z-index:9999;font-weight:700';
  document.body.appendChild(n);
  setTimeout(()=> n.remove(),2200);
}

/* STREAK calc */
function calculateStreak() {
  const uniqueDates = Array.from(new Set(mealLog.map(m => {
    const ts = m.timestamp || m.ts || (m.date ? new Date(m.date).getTime() : null);
    return ts ? new Date(ts).toLocaleDateString() : null;
  }).filter(Boolean)));

  uniqueDates.sort((a,b) => new Date(b) - new Date(a));

  let streak = 0;
  for (let i=0; ; i++) {
    const check = new Date();
    check.setDate(check.getDate() - i);
    const ds = check.toLocaleDateString();
    if (uniqueDates.includes(ds)) streak++; else break;
  }

  document.getElementById('streak').textContent = streak;
}

/* ---------------- Chart ---------------- */
let weeklyChart = null;
function createChart(){
  const ctx = document.getElementById('weeklyChart').getContext('2d');
  weeklyChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: weekKeys,
      datasets: [{
        label: 'Calories',
        data: weekKeys.map(k => Number(weeklyData[k] || 0)),
        backgroundColor: weekKeys.map(k => 'rgba(78,205,196,0.72)'),
        borderColor: weekKeys.map(k => 'rgba(78,205,196,1)'),
        borderWidth: 1,
        borderRadius: 8
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        y: { beginAtZero: true, title: { display: true, text: 'Calories' } }
      },
      plugins: { legend: { display: false } }
    }
  });
}

function updateChart(){
  if (!weeklyChart) return;
  weeklyChart.data.datasets[0].data = weekKeys.map(k => Number(weeklyData[k] || 0));
  weeklyChart.update();
}

/* Initialize */
document.addEventListener('DOMContentLoaded', () => {
  updateDisplay();
  createChart();
  calculateStreak();
});
</script>
</body>
</html>
